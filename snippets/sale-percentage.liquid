{%- doc -%}
  This snippet displays the sale percentage for a product.
  It calculates the discount percentage based on compare_at_price and price.

  @param {product} product_resource - The product to calculate sale percentage for
  @param {string} [color_scheme] - Optional color scheme for the badge
  @param {number} [border_radius] - Optional border radius for the badge
{%- enddoc -%}

{%- liquid
  assign selected_variant = product_resource.selected_or_first_available_variant
  assign price = selected_variant.price
  assign compare_at_price = selected_variant.compare_at_price

  assign show_sale_percentage = false
  assign sale_percentage = 0

  if compare_at_price > price and price > 0
    assign discount_amount = compare_at_price | minus: price
    assign sale_percentage = discount_amount | times: 100.0 | divided_by: compare_at_price | round
    if sale_percentage > 0
      assign show_sale_percentage = true
    endif
  endif
-%}

{%- if show_sale_percentage -%}
  <div class="sale-percentage-badge {{ color_scheme }} color-{{ color_scheme }}" style="--border-radius: {{ border_radius | default: 4 }}px;">
    <span class="sale-percentage-text">
      Save {{ sale_percentage }}%
    </span>
  </div>
{%- endif -%}

{% # theme-check-disable %}
{% stylesheet %}
  .sale-percentage-badge {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    padding: 0.25em 0.75em;
    border-radius: var(--border-radius);
  }

{% endstylesheet %}
{% # theme-check-enable %}
